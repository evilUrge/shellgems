<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
    <meta name="description" content="{{ if .IsHome }}{{ .Site.Params.description }}{{ else }}{{ .Description }}{{ end }}">
    {{ $keywordsList := slice }}
    {{ if .Params.tags }}
        {{ if reflect.IsSlice .Params.tags }}
            {{ $keywordsList = .Params.tags }}
        {{ else }}
            {{ $keywordsList = (slice .Params.tags) }}
        {{ end }}
    {{ else if .Site.Params.keywords }}
        {{ if reflect.IsSlice .Site.Params.keywords }}
            {{ $keywordsList = .Site.Params.keywords }}
        {{ else }}
            {{ $keywordsList = (slice .Site.Params.keywords) }}
        {{ end }}
    {{ end }}
    {{ if gt (len $keywordsList) 0 }}
    <meta name="keywords" content="{{ delimit $keywordsList ", " }}">
    {{ end }}
    <link rel="canonical" href="{{ .Permalink }}">

    <!-- Professional Typography System -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Core Stylesheets -->
    {{ $mainCSS := resources.Get "css/main.css" }}
    {{ if $mainCSS }}
        {{ $mainCSS = $mainCSS | resources.Minify }}
        <link rel="stylesheet" href="{{ $mainCSS.RelPermalink }}">
    {{ end }}

    <link rel="stylesheet" href="{{ "css/prism.css" | relURL }}">

    <!-- Themes (Disabled for Redesign - Main.css handles everything) -->
    {{/*
    {{ if .Site.Params.themeColor }}
        {{ $themeCSS := resources.Get (printf "css/themes/%s.css" .Site.Params.themeColor) }}
        {{ if $themeCSS }}
            {{ $themeCSS = $themeCSS | resources.Minify }}
            <link rel="stylesheet" href="{{ $themeCSS.RelPermalink }}">
        {{ end }}
    {{ else }}
        {{ $defaultThemeCSS := resources.Get "css/themes/warm-gold.css" }}
        {{ if $defaultThemeCSS }}
            {{ $defaultThemeCSS = $defaultThemeCSS | resources.Minify }}
            <link rel="stylesheet" href="{{ $defaultThemeCSS.RelPermalink }}">
        {{ end }}
    {{ end }}
    */}}

    <!-- Professional Studio Mode (Disabled for Redesign) -->
    {{/*
    {{ if .Site.Params.studioMode }}
        {{ $hackerCSS := resources.Get "css/hacker.css" }}
        {{ if $hackerCSS }}
            {{ $hackerCSS = $hackerCSS | resources.Minify }}
            <link rel="stylesheet" href="{{ $hackerCSS.RelPermalink }}">
        {{ end }}
    {{ end }}
    */}}

    <!-- Layout Enhancements (Disabled for Redesign) -->
    {{/*
    {{ if .Site.Params.fullWidthTheme }}
        {{ $fullWidthCSS := resources.Get "css/full-width.css" }}
        {{ if $fullWidthCSS }}
            {{ $fullWidthCSS = $fullWidthCSS | resources.Minify }}
            <link rel="stylesheet" href="{{ $fullWidthCSS.RelPermalink }}">
        {{ end }}
    {{ end }}

    {{ if .Site.Params.centerTheme }}
        {{ $centerCSS := resources.Get "css/center.css" }}
        {{ if $centerCSS }}
            {{ $centerCSS = $centerCSS | resources.Minify }}
            <link rel="stylesheet" href="{{ $centerCSS.RelPermalink }}">
        {{ end }}
    {{ end }}
    */}}

    <!-- Professional Meta Tags -->
    <meta name="theme-color" content="#d69e2e">
    <meta name="msapplication-TileColor" content="#1a1f2e">

    <!-- Enhanced Favicon -->
    <link rel="icon" type="image/svg+xml" href="{{ "favicon.svg" | relURL }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ "favicon/favicon-32x32.png" | relURL }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ "favicon/favicon-16x16.png" | relURL }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ "favicon/apple-touch-icon.png" | relURL }}">
    <link rel="manifest" href="{{ "favicon/site.webmanifest" | relURL }}">
    <meta name="msapplication-config" content="{{ "favicon/browserconfig.xml" | relURL }}">

    <!-- Enhanced Open Graph / Facebook -->
    <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:site_name" content="{{ .Site.Title }}">
    <meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}">
    <meta property="og:description" content="{{ if .IsHome }}{{ .Site.Params.description | default "ShellGems - Analog Meets Digital. A sophisticated blog featuring music-inspired design, technical content, and professional development insights." }}{{ else }}{{ .Description | default .Summary | truncate 160 | plainify }}{{ end }}">

    {{ $pageImageCandidate := "" }}
    {{ if .Params.cover }}
        {{ $pageImageCandidate = .Params.cover }}
    {{ else if .Params.featured_image }}
        {{ $pageImageCandidate = .Params.featured_image }}
    {{ else if .Params.featuredImage }}
        {{ $pageImageCandidate = .Params.featuredImage }}
    {{ else if .Params.image }}
        {{ $pageImageCandidate = .Params.image }}
    {{ else if .Params.images }}
        {{ if reflect.IsSlice .Params.images }}
            {{ $pageImageCandidate = (index .Params.images 0) }}
        {{ else }}
            {{ $pageImageCandidate = .Params.images }}
        {{ end }}
    {{ else if and .Site.Params.logo (not (reflect.IsMap .Site.Params.logo)) }}
        {{ $pageImageCandidate = .Site.Params.logo }}
    {{ else }}
        {{ $pageImageCandidate = "img/favicon.png" }}
    {{ end }}
    {{ $pageImage := "" }}
    {{ if or (hasPrefix $pageImageCandidate "http://") (hasPrefix $pageImageCandidate "https://") }}
        {{ $pageImage = $pageImageCandidate }}
    {{ else }}
        {{ $pageImagePath := $pageImageCandidate }}
        {{ if not (hasPrefix $pageImagePath "/") }}
            {{ $pageImagePath = printf "/%s" $pageImagePath }}
        {{ end }}
        {{ $staticPath := printf "static%s" $pageImagePath }}
        {{ if not (fileExists $staticPath) }}
            {{ if hasPrefix $pageImagePath "/images/" }}
                {{ $altPath := replace $pageImagePath "/images/" "/img/" }}
                {{ if fileExists (printf "static%s" $altPath) }}
                    {{ $pageImagePath = $altPath }}
                {{ else }}
                    {{ $pageImagePath = "/img/favicon.png" }}
                {{ end }}
            {{ else }}
                {{ $pageImagePath = "/img/favicon.png" }}
            {{ end }}
        {{ end }}
        {{ $pageImage = $pageImagePath | absURL }}
    {{ end }}
    {{ $pageImageType := "image/jpeg" }}
    {{ $pageImageExt := lower (path.Ext $pageImage) }}
    {{ if eq $pageImageExt ".png" }}{{ $pageImageType = "image/png" }}{{ end }}
    {{ if eq $pageImageExt ".webp" }}{{ $pageImageType = "image/webp" }}{{ end }}
    {{ if eq $pageImageExt ".gif" }}{{ $pageImageType = "image/gif" }}{{ end }}
    <meta property="og:image" content="{{ $pageImage }}">
    <meta property="og:image:secure_url" content="{{ $pageImage }}">
    <meta property="og:image:type" content="{{ $pageImageType }}">
    <meta property="og:image:alt" content="{{ if .IsHome }}{{ .Site.Title }} - Analog Meets Digital{{ else }}{{ .Title }}{{ end }}">

    <!-- Open Graph Locale and Additional Data -->
    <meta property="og:locale" content="{{ .Site.LanguageCode | default "en_US" }}">
    {{ if .IsPage }}
    <meta property="article:author" content="{{ .Site.Author.name | default "ShellGems" }}">
    <meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
    {{ if .Lastmod }}
    <meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
    {{ end }}
    {{ range .Params.tags }}
    <meta property="article:tag" content="{{ . }}">
    {{ end }}
    {{ if .Params.categories }}{{ range .Params.categories }}
    <meta property="article:section" content="{{ . }}">
    {{ end }}{{ end }}
    {{ end }}

    <!-- Enhanced Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    {{ if .Site.Params.twitter }}
    <meta name="twitter:site" content="@{{ .Site.Params.twitter }}">
    <meta name="twitter:creator" content="@{{ .Site.Params.twitter }}">
    {{ end }}
    <meta name="twitter:url" content="{{ .Permalink }}">
    <meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}">
    <meta name="twitter:description" content="{{ if .IsHome }}{{ .Site.Params.description | default "ShellGems - Analog Meets Digital. A sophisticated blog featuring music-inspired design, technical content, and professional development insights." }}{{ else }}{{ .Description | default .Summary | truncate 160 | plainify }}{{ end }}">

    <meta name="twitter:image" content="{{ $pageImage }}">
    <meta name="twitter:image:alt" content="{{ if .IsHome }}{{ .Site.Title }} - Analog Meets Digital Logo{{ else }}{{ .Title }}{{ end }}">

    <!-- Additional SEO Meta Tags -->
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    {{ if .IsPage }}
    <meta name="article:author" content="{{ .Site.Author.name | default "ShellGems" }}">
    {{ end }}

    <!-- Structured Data for Rich Snippets -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "{{ if .IsHome }}WebSite{{ else if .IsPage }}BlogPosting{{ else }}WebPage{{ end }}",
        "name": "{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}",
        "headline": "{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}",
        "description": "{{ if .IsHome }}{{ .Site.Params.description | default "ShellGems - Analog Meets Digital" }}{{ else }}{{ .Description | default .Summary | truncate 160 | plainify }}{{ end }}",
        "url": "{{ .Permalink }}",
        {{ if .IsPage }}
        "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
        {{ if .Lastmod }}
        "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
        {{ end }}
        "author": {
            "@type": "Person",
            "name": "{{ .Site.Author.name | default "ShellGems" }}"
        },
        {{ end }}
        {{ $publisherLogo := "img/favicon.png" | absURL }}
        {{ if and .Site.Params.logo (not (reflect.IsMap .Site.Params.logo)) }}
            {{ $publisherLogo = .Site.Params.logo | absURL }}
        {{ end }}
        "publisher": {
            "@type": "Organization",
            "name": "{{ .Site.Title }}",
            "logo": {
                "@type": "ImageObject",
                "url": "{{ $publisherLogo }}"
            }
        },
        "image": {
            "@type": "ImageObject",
            "url": "{{ $pageImage }}"
        }
    }
    </script>

    {{ block "head" . }}{{ end }}
</head>
<body class="analog-body">
    <div class="analog-grid">
        <!-- Professional Studio Container -->
        <div class="analog-studio-container">
            <!-- Header with Music-Inspired Design -->
            <header class="analog-header">
                {{ partial "header.html" . }}
            </header>

            <!-- Main Content with Professional Layout -->
            <main class="analog-main">
                <div class="analog-container">
                    {{ block "main" . }}{{ end }}
                </div>
            </main>

            <!-- Footer with Studio Aesthetics -->
            <footer class="analog-footer">
                {{ partial "footer.html" . }}
            </footer>
        </div>

    </div>

    <!-- Mermaid.js for Diagram Support -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Mermaid with professional theme colors matching the site
            mermaid.initialize({
                startOnLoad: false,
                theme: 'dark',
                themeVariables: {
                    primaryColor: '#d69e2e',
                    primaryTextColor: '#ffffff',
                    primaryBorderColor: '#dd6b20',
                    lineColor: '#f6ad55',
                    secondaryColor: '#1a1f2e',
                    tertiaryColor: '#2d3748',
                    background: '#1a1f2e',
                    mainBkg: '#2d3748',
                    secondBkg: '#1a1f2e',
                    tertiaryBkg: '#4a5568'
                },
                flowchart: {
                    htmlLabels: true,
                    curve: 'basis'
                },
                sequence: {
                    diagramMarginX: 50,
                    diagramMarginY: 10,
                    actorMargin: 50,
                    width: 150,
                    height: 65,
                    boxMargin: 10,
                    boxTextMargin: 5,
                    noteMargin: 10,
                    messageMargin: 35
                }
            });

            // Find and convert only mermaid code blocks (be very specific)
            const mermaidBlocks = document.querySelectorAll('pre code.language-mermaid');

            mermaidBlocks.forEach((block, index) => {
                // Double-check this is actually a mermaid block
                if (block.className === 'language-mermaid' || block.classList.contains('language-mermaid')) {
                    // Get the mermaid code content
                    const mermaidCode = block.textContent || block.innerText;

                    // Create a new div for the mermaid diagram
                    const mermaidDiv = document.createElement('div');
                    mermaidDiv.className = 'mermaid';
                    mermaidDiv.textContent = mermaidCode;
                    mermaidDiv.id = `mermaid-diagram-${index}`;

                    // Replace the code block with the mermaid div
                    const preElement = block.closest('pre');
                    if (preElement) {
                        preElement.parentNode.replaceChild(mermaidDiv, preElement);
                    }
                }
            });

            // Also look for any existing .mermaid divs and process them
            const existingMermaidDivs = document.querySelectorAll('.mermaid');
            if (existingMermaidDivs.length > 0) {
                mermaid.init(undefined, existingMermaidDivs);
            }
        });
    </script>

    <!-- Professional JavaScript -->
    <script src="{{ "js/prism.js" | relURL }}"></script>
    {{ $mainJS := resources.Get "js/main.js" }}
    {{ if $mainJS }}
        {{ $mainJS = $mainJS | resources.Minify }}
        <script src="{{ $mainJS.RelPermalink }}"></script>
    {{ end }}

    <!-- Studio Equipment JavaScript -->
    {{ if .Site.Params.studioMode }}
    <script>
        // Professional studio mode enhancements
        document.addEventListener('DOMContentLoaded', function() {
            // Add professional studio indicators
            const indicators = document.querySelectorAll('.studio-indicator');
            indicators.forEach((indicator, index) => {
                setTimeout(() => {
                    indicator.classList.add('active');
                }, (index + 1) * 300);
            });

            // Professional scroll behavior
            let ticking = false;
            function updateScrollIndicator() {
                const scrolled = window.scrollY;
                const maxHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollProgress = scrolled / maxHeight;

                document.documentElement.style.setProperty('--scroll-progress', scrollProgress);
                ticking = false;
            }

            window.addEventListener('scroll', function() {
                if (!ticking) {
                    requestAnimationFrame(updateScrollIndicator);
                    ticking = true;
                }
            });
        });
    </script>
    {{ end }}

    <!-- Analytics and Performance -->
    {{ if hugo.IsProduction }}
        {{ with site.Config.Services.GoogleAnalytics.ID }}
            {{ template "_internal/google_analytics.html" . }}
        {{ end }}
    {{ end }}

    {{ block "scripts" . }}{{ end }}
</body>
</html>
